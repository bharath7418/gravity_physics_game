<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Physics | Mobile Optimized Edition</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; background: #050508; color: white; user-select: none; touch-action: none; }
        
        /* --- NAVBAR STYLES --- */
        #ui { 
            position: absolute; top: 0; left: 0; width: 100%; height: 60px;
            display: flex; align-items: center; justify-content: space-around;
            padding: 0 10px;
            background: rgba(10, 15, 30, 0.8); backdrop-filter: blur(12px); 
            border-bottom: 1px solid rgba(0, 210, 255, 0.3);
            z-index: 10; box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            box-sizing: border-box;
        }
        
        .ui-group { display: flex; align-items: center; gap: 10px; }
        .label { font-size: 9px; text-transform: uppercase; letter-spacing: 1px; color: #00d2ff; opacity: 0.8; }
        .value { font-size: 16px; font-weight: 800; font-variant-numeric: tabular-nums; }
        
        #magnetStatus { color: #ff4757; font-weight: bold; display: none; animation: pulse 1s infinite; text-shadow: 0 0 10px #ff4757; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        #hearts { font-size: 16px; filter: drop-shadow(0 0 5px rgba(255, 71, 87, 0.5)); }
        
        .progress-box { width: 80px; height: 8px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; }
        #fuelBar { width: 0%; height: 100%; background: linear-gradient(90deg, #00d2ff, #00ff88); transition: width 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        
        /* --- MODALS --- */
        #message, #gameOver, #infoPanel, #summaryPanel { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            background: rgba(2, 5, 15, 0.95); padding: 30px; border-radius: 30px; 
            text-align: center; border: 1px solid #00d2ff; display: none; z-index: 100;
            box-shadow: 0 0 100px rgba(0, 210, 255, 0.2);
            width: 85%; max-width: 450px; box-sizing: border-box;
        }
        
        button { 
            background: #fff; border: none; padding: 15px 35px; font-weight: 900; 
            border-radius: 40px; cursor: pointer; margin-top: 20px; color: #000; 
            text-transform: uppercase; transition: 0.3s;
        }
        button:hover { transform: scale(1.05); background: #00d2ff; color: white; }
        
        #summaryPanel { max-height: 80vh; overflow-y: auto; }
        #summaryPanel table { margin-top: 20px; border-collapse: collapse; width: 100%; font-size: 10px; }
        #summaryPanel th { text-align: left; color: #00d2ff; padding: 8px; border-bottom: 2px solid #00d2ff; }
        #summaryPanel td { padding: 6px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
        
        /* --- MOBILE CONTROLS --- */
        .touch-controls {
            position: absolute; bottom: 30px; left: 0; width: 100%;
            display: flex; justify-content: space-between; padding: 0 30px;
            box-sizing: border-box; z-index: 50; pointer-events: none;
        }
        .t-btn {
            width: 65px; height: 65px; background: rgba(255,255,255,0.1);
            border: 2px solid rgba(0, 210, 255, 0.4); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-size: 24px; pointer-events: auto;
            -webkit-tap-highlight-color: transparent; backdrop-filter: blur(4px);
        }
        .t-btn:active { background: rgba(0, 210, 255, 0.4); transform: scale(0.9); }

        canvas { display: block; }

        @media (min-width: 800px) {
            .touch-controls { display: none; }
            .value { font-size: 20px; }
            .label { font-size: 10px; }
            .progress-box { width: 150px; }
        }
    </style>
</head>
<body>

<div id="ui">
    <div class="ui-group">
        <span id="hearts" class="value">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span>
        <span id="magnetStatus">üß≤</span>
    </div>
    
    <div class="ui-group">
        <span id="planetName" class="value">Earth üåç</span>
    </div>

    <div class="ui-group">
        <span class="label">G:</span>
        <span id="gravityVal" class="value">9.8</span>
    </div>

    <div class="ui-group">
        <span id="timer" class="value">00:00</span>
    </div>

    <div class="ui-group">
        <div class="progress-box"><div id="fuelBar"></div></div>
    </div>
</div>

<div class="touch-controls">
    <div style="display:flex; gap: 15px;">
        <div class="t-btn" id="btnLeft">‚¨ÖÔ∏è</div>
        <div class="t-btn" id="btnRight">‚û°Ô∏è</div>
    </div>
    <div class="t-btn" id="btnJump">üöÄ</div>
</div>

<div id="infoPanel" style="display:block;">
    <h1 id="infoTitle" style="font-size: 28px; margin:0;">Welcome to Sector 1</h1>
    <p id="infoText" style="opacity: 0.7; font-size: 14px;">Collect 3 fuel to reach orbit. Watch out for debris!</p>
    <button onclick="closeInfo()">Begin Mission</button>
</div>

<div id="message">
    <h1 style="font-size: 30px; margin:0;">ORBIT REACHED</h1>
    <button onclick="nextLevel()">Engage Warp Drive</button>
</div>

<div id="summaryPanel">
    <h1 style="color:#00ff88; font-size: 28px; margin:0;">JOURNEY COMPLETE</h1>
    <p style="opacity: 0.7;">Final Expedition Summary:</p>
    <table id="summaryTable">
        <tr>
            <th>Planet</th>
            <th>Time</th>
            <th>Gravity</th>
            <th>Atmo</th>
        </tr>
    </table>
    <button onclick="location.reload()">Restart</button>
</div>

<div id="gameOver">
    <h1 style="color:#ff4757; font-size: 32px; margin:0;">MISSION LOST</h1>
    <button onclick="location.reload()" style="background:#ff4757; color: white;">Restart</button>
</div>

<canvas id="game"></canvas>

<script>
// --- AUDIO ENGINE ---
let audioCtx;
function initAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
window.addEventListener('touchstart', initAudio);
window.addEventListener('click', initAudio);

function playSound(type) {
    if (!audioCtx) return;
    const osc = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    osc.connect(gainNode); gainNode.connect(audioCtx.destination);
    switch(type) {
        case 'fuel':
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.start(); osc.stop(audioCtx.currentTime + 0.2);
            break;
        case 'magnet':
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.5);
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            osc.start(); osc.stop(audioCtx.currentTime + 0.5);
            break;
        case 'damage':
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(150, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.3);
            gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
            osc.start(); osc.stop(audioCtx.currentTime + 0.4);
            break;
        case 'launch':
            osc.type = 'triangle';
            osc.frequency.setValueAtTime(100, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(10, audioCtx.currentTime + 2);
            gainNode.gain.setValueAtTime(0.8, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 2);
            osc.start(); osc.stop(audioCtx.currentTime + 2);
            break;
    }
}

// --- GAME LOGIC ---
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
let groundY;

function resize() { 
    canvas.width = window.innerWidth; 
    canvas.height = window.innerHeight;
    groundY = canvas.height - 100;
    rocket.x = canvas.width - (canvas.width < 600 ? 120 : 250);
    rocket.y = groundY - 140;
}
window.addEventListener('resize', resize);

// --- PLANET DATA ---
const planets = [
    {name:"Earth üåç", g:0.6, realVal:"9.8", speedVal:"Normal", jump:-16, speed: 8, sky:["#0a1a3a", "#1e3c72", "#2a5298"], ground:"#1a5e3a", det:"#2ecc71", atm:"rgba(0, 210, 255, 0.2)", fColor:"#2ecc71", atmoType:"Nitrogen", o2:"21%", info:"Gravity is 9.8 m/s¬≤. The cradle of humanity."},
    {name:"Moon üåï", g:0.1, realVal:"1.6", speedVal:"Very Fast", jump:-10, speed: 10, sky:["#000000", "#050505", "#111111"], ground:"#333333", det:"#777777", atm:"rgba(255, 255, 255, 0.05)", fColor:"#95a5a6", atmoType:"None", o2:"0%", info:"Gravity is 1.6 m/s¬≤. Low gravity allows for huge jumps!"},
    {name:"Mars üî¥", g:0.25, realVal:"3.7", speedVal:"Fast", jump:-13, speed: 9, sky:["#2c0a0a", "#4d0505", "#8b0000"], ground:"#6d2108", det:"#e67e22", atm:"rgba(255, 100, 0, 0.15)", fColor:"#e67e22", atmoType:"Thin CO2", o2:"<0.1%", info:"Gravity is 3.7 m/s¬≤. The red planet is dusty and cold."},
    {name:"Mercury üåë", g:0.25, realVal:"3.7", speedVal:"Fast", jump:-13, speed: 9, sky:["#111111", "#222222", "#333333"], ground:"#4a4a4a", det:"#888888", atm:"rgba(100, 100, 100, 0.1)", fColor:"#bdc3c7", atmoType:"Trace", o2:"0%", info:"Gravity is 3.7 m/s¬≤. Scorched by the Sun."},
    {name:"Jupiter üü†", g:1.5, realVal:"24.7", speedVal:"Very Slow", jump:-30, speed: 5, sky:["#1a0f00", "#432818", "#5d4037"], ground:"#5e3a24", det:"#f39c12", atm:"rgba(243, 156, 18, 0.1)", fColor:"#f39c12", atmoType:"Thick H/He", o2:"0%", info:"Gravity is 24.7 m/s¬≤. Massive pressure makes movement difficult."},
    {name:"Saturn ü™ê", g:0.65, realVal:"10.4", speedVal:"Slow", jump:-16, speed: 7, sky:["#251b00", "#5d4037", "#a08e7a"], ground:"#7b6140", det:"#f1c40f", atm:"rgba(241, 196, 15, 0.1)", fColor:"#f1c40f", atmoType:"Thick H/He", o2:"0%", info:"Gravity is 10.4 m/s¬≤. Famous for its rings."},
    {name:"Uranus üßä", g:0.55, realVal:"8.7", speedVal:"Medium", jump:-15, speed: 7, sky:["#002030", "#004060", "#005f80"], ground:"#004060", det:"#a3e4d7", atm:"rgba(163, 228, 215, 0.1)", fColor:"#a3e4d7", atmoType:"Thick H/He/CH4", o2:"0%", info:"Gravity is 8.7 m/s¬≤. An icy, blue giant."},
    {name:"Neptune üîµ", g:0.7, realVal:"11.15", speedVal:"Slow", jump:-18, speed: 6, sky:["#000022", "#000044", "#000066"], ground:"#002244", det:"#0077ff", atm:"rgba(0, 100, 255, 0.1)", fColor:"#0077ff", atmoType:"Thick H/He", o2:"0%", info:"Gravity is 11.15 m/s¬≤. The icy giant is freezing cold."},
    {name:"Venus üü°", g:0.55, realVal:"8.87", speedVal:"Medium", jump:-15, speed: 7, sky:["#3a1a00", "#723c1e", "#98522a"], ground:"#5e3a24", det:"#f39c12", atm:"rgba(255, 150, 0, 0.2)", fColor:"#f39c12", atmoType:"Very Thick CO2", o2:"0%", info:"Gravity is 8.87 m/s¬≤. A hellish landscape with high pressure."}
];

let planetIndex = 0;
let gameState = "paused"; 
let launchY = 0;
let shake = 0;
let stars = Array.from({length: 80}, () => ({x: Math.random(), y: Math.random(), size: Math.random() * 2}));

let player = { x:50, y:0, vy:0, onGround:true, lives: 3, magnetActive: false, magnetTimer: 0, facing: 1, walkFrame: 0, visible: true };
let rocket = { x:0, y:0, fuel:0 };
let fuelCans = []; let meteors = []; let magnets = []; let collected = 0;
const keys = {};

// --- TOUCH HANDLING ---
function setupTouch() {
    const bindBtn = (id, code) => {
        const el = document.getElementById(id);
        el.addEventListener('touchstart', (e) => { e.preventDefault(); keys[code] = true; initAudio(); });
        el.addEventListener('touchend', (e) => { e.preventDefault(); keys[code] = false; });
    };
    bindBtn('btnLeft', 'ArrowLeft');
    bindBtn('btnRight', 'ArrowRight');
    bindBtn('btnJump', 'Space');
}

let startTime;
let timeInterval;
let planetTimes = [];

function startTimer() { startTime = Date.now(); timeInterval = setInterval(updateTimerDisplay, 1000); }
function stopTimer() { clearInterval(timeInterval); return formatTime(Date.now() - startTime); }
function updateTimerDisplay() { document.getElementById("timer").innerText = formatTime(Date.now() - startTime); }
function formatTime(ms) {
    let s = Math.floor(ms / 1000);
    return `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
}

function updateUI() {
    const p = planets[planetIndex];
    document.getElementById("planetName").innerText = p.name;
    // Updated gravity display
    document.getElementById("gravityVal").innerText = p.realVal;
    document.getElementById("fuelBar").style.width = (rocket.fuel / 3 * 100) + "%";
    document.getElementById("magnetStatus").style.display = player.magnetActive ? "inline" : "none";
    let heartStr = "";
    for(let i=0; i<player.lives; i++) heartStr += "‚ù§Ô∏è";
    document.getElementById("hearts").innerText = heartStr || "üíÄ";
}

function spawnFuel() {
    fuelCans.push({ x: 100 + Math.random() * (canvas.width - 200), y: groundY - 50 - Math.random() * 250, pulse: 0 }); 
}
function spawnMeteor() { if(gameState === "playing") meteors.push({ x: Math.random() * canvas.width, y: -50, speed: 3 + Math.random() * 5 }); }
function spawnMagnet() { if(gameState === "playing") magnets.push({ x: Math.random() * (canvas.width - 100), y: -50, speed: 2 }); }

function loadLevel() {
    let p = planets[planetIndex];
    document.getElementById("infoTitle").innerText = p.name;
    document.getElementById("infoText").innerText = p.info;
    document.getElementById("infoPanel").style.display = "block";
    fuelCans = []; meteors = []; magnets = [];
    for(let i=0; i<3; i++) spawnFuel();
    updateUI();
}

window.closeInfo = function() { document.getElementById("infoPanel").style.display = "none"; gameState = "playing"; startTimer(); }

resize();
setupTouch();
setInterval(spawnMeteor, 2500);
setInterval(spawnMagnet, 12000);
document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

function drawEnvironment() {
    let p = planets[planetIndex];
    let skyGrad = ctx.createLinearGradient(0, 0, 0, canvas.height);
    skyGrad.addColorStop(0, p.sky[0]); skyGrad.addColorStop(1, p.sky[2]);
    ctx.fillStyle = skyGrad; ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    stars.forEach(s => { ctx.globalAlpha = 0.4; ctx.fillRect(s.x * canvas.width, s.y * canvas.height, s.size, s.size); });
    ctx.globalAlpha = 1;
    ctx.fillStyle = p.ground; ctx.fillRect(0, groundY, canvas.width, 100);
}

function drawFuelTank(x, y, pulse, color) {
    ctx.save(); ctx.translate(x, y);
    ctx.fillStyle = "#f1f2f6"; ctx.beginPath(); ctx.roundRect(-8, -15, 16, 30, 4); ctx.fill();
    ctx.fillStyle = color; ctx.fillRect(-5, -5 + Math.sin(pulse)*2, 10, 15);
    ctx.restore();
}

function drawRocket(x, y, fuel, isLaunching) {
    ctx.save();
    let hover = isLaunching ? 0 : Math.sin(Date.now() / 300) * 5;
    ctx.translate(x + 35, y + 60 + hover - launchY); 
    ctx.fillStyle = "#ff4757"; ctx.beginPath(); ctx.moveTo(-30, 20); ctx.lineTo(-45, 50); ctx.lineTo(-15, 40); ctx.fill();
    ctx.moveTo(30, 20); ctx.lineTo(45, 50); ctx.lineTo(15, 40); ctx.fill();
    ctx.fillStyle = "#f1f2f6"; ctx.beginPath(); ctx.moveTo(-25, 40); ctx.quadraticCurveTo(-30, -20, 0, -70); ctx.quadraticCurveTo(30, -20, 25, 40); ctx.fill();
    if (fuel > 0 || isLaunching) {
        ctx.fillStyle = "#ffa502"; ctx.beginPath(); ctx.moveTo(-10, 40); ctx.lineTo(0, 70 + (isLaunching?50:0)); ctx.lineTo(10, 40); ctx.fill();
    }
    ctx.restore();
}

function drawAstronaut(x, y, facing) {
    if (!player.visible) return;
    ctx.save(); ctx.translate(x, y); ctx.scale(facing, 1);
    ctx.fillStyle = "white"; ctx.beginPath(); ctx.arc(0, -30, 14, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = "#2f3542"; ctx.beginPath(); ctx.ellipse(5, -30, 10, 7, 0, 0, Math.PI * 2); ctx.fill();
    ctx.fillStyle = "#ecf0f1"; ctx.fillRect(-10, -18, 20, 18);
    ctx.restore();
}

function update() {
    if(player.lives <= 0) { document.getElementById("gameOver").style.display = "block"; return; }
    if(gameState !== "playing") return;

    const p = planets[planetIndex];
    if(keys["ArrowRight"]) { player.x += p.speed; player.facing = 1; }
    if(keys["ArrowLeft"]) { player.x -= p.speed; player.facing = -1; }
    if(keys["Space"] && player.onGround) { player.vy = p.jump; player.onGround = false; }
    
    player.vy += p.g; player.y += player.vy;
    if(player.y >= groundY) { player.y = groundY; player.vy = 0; player.onGround = true; }
    player.x = Math.max(15, Math.min(canvas.width - 15, player.x));

    if(player.magnetActive) { player.magnetTimer--; if(player.magnetTimer <= 0) player.magnetActive = false; }
    
    fuelCans.forEach((f, i) => {
        f.pulse += 0.1;
        let dist = Math.hypot(player.x - f.x, (player.y-20) - f.y);
        if(player.magnetActive && dist < 250) { f.x += (player.x - f.x) * 0.1; f.y += ((player.y-20) - f.y) * 0.1; }
        if(dist < 40) { fuelCans.splice(i, 1); collected++; playSound('fuel'); updateUI(); }
    });
    
    if(Math.hypot(player.x - (rocket.x+35), (player.y-20) - (rocket.y+60)) < 70 && collected > 0) {
        rocket.fuel += collected; collected = 0; updateUI();
        if(rocket.fuel >= 3) { planetTimes.push({name: p.name, time: stopTimer()}); gameState = "boarding"; }
    }

    meteors.forEach((m, i) => {
        m.y += m.speed;
        if(Math.hypot(player.x - m.x, (player.y-20) - m.y) < 30) { meteors.splice(i, 1); player.lives--; playSound('damage'); updateUI(); }
    });

    magnets.forEach((mag, i) => {
        mag.y += mag.speed;
        if(Math.hypot(player.x - mag.x, (player.y-20) - mag.y) < 40) { magnets.splice(i, 1); player.magnetActive = true; player.magnetTimer = 400; playSound('magnet'); updateUI(); }
    });
}

function loop() {
    update();
    if(gameState === "boarding") {
        let tx = rocket.x + 35;
        if(Math.abs(player.x - tx) > 5) player.x += (player.x < tx ? 2 : -2);
        else { player.visible = false; playSound('launch'); gameState = "launching"; }
    }
    if(gameState === "launching") {
        launchY += 7; shake = 5;
        if(launchY > canvas.height + 200) {
            if(planetIndex === planets.length-1) showSummary();
            else document.getElementById("message").style.display = "block";
            gameState = "finished";
        }
    }
    
    ctx.save();
    if(shake > 0) { ctx.translate(Math.random()*shake, Math.random()*shake); shake *= 0.9; }
    drawEnvironment();
    if(player.magnetActive && player.visible) {
        ctx.strokeStyle = "cyan"; ctx.lineWidth = 1; ctx.beginPath();
        ctx.arc(player.x, player.y-20, 60 + Math.sin(Date.now()/100)*5, 0, Math.PI*2); ctx.stroke();
    }
    drawAstronaut(player.x, player.y, player.facing);
    drawRocket(rocket.x, rocket.y, rocket.fuel, gameState === "launching");
    fuelCans.forEach(f => drawFuelTank(f.x, f.y, f.pulse, planets[planetIndex].fColor));
    meteors.forEach(m => { ctx.fillStyle = "#555"; ctx.beginPath(); ctx.arc(m.x, m.y, 15, 0, Math.PI*2); ctx.fill(); });
    magnets.forEach(m => { ctx.fillStyle = "#ff4757"; ctx.font = "20px Arial"; ctx.fillText("üß≤", m.x-10, m.y); });
    ctx.restore();
    requestAnimationFrame(loop);
}

function showSummary() {
    let table = document.getElementById("summaryTable");
    planetTimes.forEach(p => {
        let d = planets.find(pl => pl.name === p.name);
        let r = table.insertRow();
        r.insertCell(0).innerText = p.name;
        r.insertCell(1).innerText = p.time;
        r.insertCell(2).innerText = d.realVal;
        r.insertCell(3).innerText = d.atmoType;
    });
    document.getElementById("summaryPanel").style.display = "block";
}

function nextLevel() {
    planetIndex = (planetIndex + 1) % planets.length;
    
    // Reset Rocket & Launch physics
    rocket.fuel = 0; 
    launchY = 0; 
    shake = 0;

    // Reset Player State
    player.visible = true; 
    player.x = 50;
    player.vy = 0;
    player.onGround = true;

    // --- FIX: Reset Magnet Status ---
    player.magnetActive = false;
    player.magnetTimer = 0;

    // UI and Level Loading
    document.getElementById("message").style.display = "none";
    loadLevel();
}

loadLevel();
loop();
</script>
</body>
</html>